function someMatch(cb, host, list) {
  for (var i = 0; i < list.length; i++) {
    if (Array.isArray(list[i])) {
      if (cb.apply(null, [host].concat(list[i]))) return true;
    } else {
      if (cb(host, list[i])) return true;
    }
  }
  return false;
}

function isPrivate(host) {
  if (dnsDomainLevels(host) === 0) return true;
  if (!/^\d+\.\d+\.\d+\.\d+$/.test(host)) return false;

  var private = [
    ['127.0.0.0', '255.0.0.0'],
    ['10.0.0.0', '255.0.0.0'],
    ['172.16.0.0', '255.240.0.0'],
    ['192.168.0.0', '255.255.0.0'],
  ];
  return someMatch(isInNet, host, private);
}

var proxies = {
  beef: 'SOCKS proxy.in.jsx.jp:8010',
  pork: '',
  chicken: 'SOCKS proxy.in.jsx.jp:11023',
  mutton: 'PROXY proxy.jsx.jp:3128',
  venison: 'PROXY proxy.us.jsx.jp:3128',
  veal: 'PROXY proxy.jsx.jp:3128',
  deny: 'SOCKS 127.0.0.9:9',
};

function FindProxyForURL(url, host) {
  var fish = [
    ['172.16.176.0', '255.255.255.0'],
    ['172.16.150.0', '255.255.255.0'],
    ['172.16.128.0', '255.255.255.0'],
  ];
  if (someMatch(isInNet, host, fish)) return proxies.beef;

  var external = [
    '*.next*ure.jp',
    'ni*bo.jp',
    '*.ni*bo.jp',
    '*.measurement-lab.org',
    '*.pan*nic.co.jp',
    '*.pan*nic.com',
    '*.s3-ap-northeast-1.amazonaws.com',
    '*.cloudfront.net',
  ];
  if (someMatch(isInNet, host, external)) return proxies.beef;

  if (isPrivate(host)) return 'DIRECT';

  var allowDirect = [
    'proxy.*', 'cdn.*', 'jsx.jp', 'www.jsx.jp', 'cdn.jsx.jp', '*.cdn.jsx.jp',
    '*.nip.io', '*.xip.io', '*.quest', '*.strategy*.com',
  ];
  if (someMatch(shExpMatch, host, allowDirect)) return 'DIRECT';

  var chicken = [['10.0.0.0', '255.255.0.0']];
  if (someMatch(isInNet, host, chicken)) return proxies.chicken;

  var internal = ['*.internal'];
  if (someMatch(shExpMatch, host, internal)) return proxies.beef;

  var denySite = ['txcom-ad.s3-ap-northeast-1.amazonaws.com'];
  if (someMatch(shExpMatch, host, denySite)) return proxies.deny;

  var ai = ['chat.openai.com', 'gemini.google.com', 'copilot.microsoft.com'];
  if (someMatch(shExpMatch, host, ai)) return proxies.veal;

  var microsoft = ['*.microsoft.com', '*.microsoftonline.com', '*.office.com'];
  if (someMatch(shExpMatch, host, microsoft)) return proxies.beef;

  var google = ['*.google.co.jp', '*.google.com'];
  if (someMatch(shExpMatch, host, google)) return proxies.beef;

  var aws = ['*.aws.amazon.com', '*.amazonaws.com', '*.cloudfront.net'];
  if (someMatch(shExpMatch, host, aws)) return proxies.beef;

  var amazon = ['*.amazon.co.jp', '*.amazon.com'];
  if (someMatch(shExpMatch, host, amazon)) return proxies.mutton;

  var ads = [
    'cu-ad.tbs.co.jp',
    'cu-cdn-ad.ntv.co.jp',
    'cu-cdn-ad-v3.ntv.co.jp',
    'cu-ad.mbs.jp',
    'cdncuad.ktv.jp',
    'fod-cm-ad-v.webcdn.stream.ne.jp',
    'i.socdm.com',
    's.socdm.com',
    'gcdn.2mdn.net',
    'cdn.spotxcdn.com',
    'cdn.as.amanad.adtdp.com',
    'videoad.tv-tokyo.co.jp',
    'chesterstream.akamaized.net',
    'tver-pmp.dspcdn.com',
    'video-assets.mathtag.com',
    'v.adsrvr.org',
    'redirector.gvt1.com',
    'ak-act.pubmatic.com',
    'm.ads.tver.jp',
    '*googleads.*',
    '*.yimg.jp',
    '*ads.g.doubleclick.net',
    'mf.socdm.com',
    '*.aiv-delivery.net',
    '*.amazon.pv-cdn.net',
    '*.aux.pv-cdn.net',
  ];
  if (someMatch(shExpMatch, host, ads)) return proxies.mutton;

  return proxies.mutton + '; DIRECT';
}
